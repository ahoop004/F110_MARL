scenario:
  name: gaplock_dqn
  env:
    seed: 42
    n_agents: 2
    max_steps: 10000

    lidar_beams: 54
    # vehicle_params:
    #   v_min: -2.0
    #   v_max: 10.0
    map: Shanghai_map

    # render_mode: human
    update: 2
    terminate_on_any_done: true
    spawn_points:
      - spawn_1
      - spawn_2

  reward:
    task: gaplock
    features:
      - gaplock_offense
    params:
      # reward_horizon: 500.0
      target_crash_reward: 10.0
      self_collision_penalty: -1.0
      reward_weight: null
      reward_decay: null
      reward_smoothing: null
      relative_reward:
        weights:
          front: 0.0
          front_right: 0.15
          right: 0.1
          back_right: 0.015
          back: -0.01
          back_left: 0.015
          left: 0.1
          front_left: 0.15
        preferred_radius: 0.50
        inner_tolerance: 0.2
        outer_tolerance: 0.2
        # falloff: linear
        # scale: 1.0
  main:
    wandb:
      enabled: true
      project: marl-f110
      entity: ahoop004-old-dominion-university
      group: dqn
      tags:
      - dqn
    mode: train_eval
    save_eval_rollouts: true
    eval_rollout_dir: eval_rollouts
    train_episodes: 1000
    eval_episodes: 1
    checkpoint: checkpoints/dqn_gaplock/dqn_gaplock.pt
  algorithms:
    dqn:
      device: cpu
      lr: 0.0004
      gamma: 0.995
      batch_size: 512
      buffer_size: 200000
      target_update_interval: 500
      epsilon_start: .9980
      epsilon_end: 0.05
      epsilon_decay_rate: 0.996
      hidden_dims:
      - 256
      - 256
      prioritized_replay: true
      per_alpha: 0.6
      per_beta_start: 0.4
      per_beta_increment: 5.0e-05
      per_min_priority: 0.001
      per_epsilon: 1.0e-06
      action_mode: rate
      steering_rate: 0.5
      accel_rate: 5.0
      brake_rate: 3.0
      rate_initial_speed: 2.0
      train_episodes: 1000
      eval_episodes: 1
      save_dir: checkpoints/dqn_gaplock
      checkpoint_name: dqn_gaplock.pt
  agents:
    car_1:
      slot: 1
      trainable: true
      wrappers:
      - factory: obs
        params:
          max_scan: 30.0
          normalize: true
          components:
          - id: lidar
            type: lidar
            params:
              beams: 54
              max_range: 30.0
              normalize: true
          - id: ego_pose
            type: ego_pose
            params:
              normalize_xy: 30.0
              angle_mode: sin
          - id: ego_collision
            type: collision
          - id: target_pose
            type: target_pose
            params:
              normalize_xy: 30.0
              angle_mode: sin_cos
            target:
              agent: car_0
          - id: target_collision
            type: collision
            target:
              agent: car_0
      algo: dqn
      config_ref: dqn
      agent_id: car_1
    
    car_0:
      algo: follow_gap
      slot: 0
      trainable: false
      params:
        max_speed: 18.0
        min_speed: 2.0
        steering_gain: 0.95
        bubble_radius: 4
        steer_smooth: 0.0
      agent_id: car_0
      wrappers:
      - factory: obs
        params:
          max_scan: 30.0
          normalize: true
          components:
          - id: lidar
            type: lidar
            params:
              beams: 54
              max_range: 30.0
              normalize: true
